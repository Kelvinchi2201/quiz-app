---
// src/components/Quiz.astro
import questionsData from '../data/questions.json';
import QuestionCard from './Questioncard.astro';
import ResultsScreen from './Results.astro';

const questions = questionsData;
---

<div id="quiz-container" class="max-w-2xl mx-auto p-4 md:p-8 bg-slate-800 rounded-lg shadow-xl text-white">
  <div id="start-screen">
    <h2 class="text-3xl font-bold mb-4">¡Bienvenido al Cuestionario!</h2>
    <p class="mb-6">Pon a prueba tus conocimientos sobre cultura general sera divertido.</p>
    <button id="start-btn" class="w-full bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-3 px-4 rounded-lg text-lg transition-colors">
      Iniciar Cuestionario
    </button>
  </div>
  
  <div id="question-screen" class="hidden">
    </div>

  <div id="results-screen" class="hidden">
    </div>
</div>

<script is:inline define:vars={{ questions }}>
    // ts-nocheck
   
    let gameState = "start"; // 'start', 'playing', 'finished'
    let currentQuestionIndex = 0;
    let score = 0;
    let userAnswers = [];

    const startScreen = document.querySelector('#start-screen');
    const questionCreen = document.querySelector('#question-screen');
    const resultsScreen = document.querySelector('#results-screen');
    const startBtn = document.querySelector('#start-btn');

    const startGame = () => {
        gameState = "playing";

         currentQuestionIndex = 0;
         score = 0;
         userAnswers = [];
        startScreen.classList.add('hidden');
        resultsScreen.classList.add('hidden');
        questionCreen.classList.remove('hidden');
        displayQuestion();
    };

    const displayQuestion = () =>{
     if (currentQuestionIndex >= questions.length) {
         endGame();
      return;
     }

     const question = questions[currentQuestionIndex];
        questionCreen.innerHTML = `
         <div class="mb-4">
        <p class="text-slate-400">Pregunta ${currentQuestionIndex + 1} de ${questions.length}</p>
        <h3 class="text-2xl font-semibold">${question.question}</h3>
      </div>
      <div id="options-container" class="grid grid-cols-1 gap-4">
        ${question.options.map((option, index) => `
          <button data-index="${index}" class="option-btn w-full bg-slate-700 hover:bg-indigo-600 text-white font-medium py-3 px-4 rounded-lg text-left transition-colors">
            ${option}
          </button>
        `).join('')}
      </div>
      `;
      document.querySelectorAll('.option-btn').forEach(button => {
      button.addEventListener('click', handleAnswerSelect);
    });
    };

    const handleAnswerSelect = (event) => {
         const selectedButton = event.currentTarget;
    const selectedIndex = parseInt(selectedButton.dataset.index);
    const question = questions[currentQuestionIndex];
    const isCorrect = selectedIndex === question.correctAnswer;
    if (isCorrect) {
        score++;
    }
     userAnswers.push({ question: question.question, answer: selectedIndex, isCorrect });
      const allOptionBtns = document.querySelectorAll('.option-btn');
    
    
      allOptionBtns.forEach((btn, index) => {
      btn.disabled = true;
      btn.classList.remove('hover:bg-indigo-600');
      btn.classList.remove('bg-slate-700');
   if (index === question.correctAnswer) {
        btn.classList.add('bg-green-600'); 
      } else if (index === selectedIndex) {
        btn.classList.add('bg-red-600'); 
      } else {
        btn.classList.add('bg-slate-600', 'opacity-50'); 
      }
    });
    setTimeout(() => {
      currentQuestionIndex++;
      displayQuestion();
    }, 1500); // 1.5 segundos para que el usuario vea el feedback
  };

  const endGame = () => {
    gameState = "finished";
    questionCreen.classList.add('hidden');
    resultsScreen.classList.remove('hidden');
    resultsScreen.innerHTML = `
      <h2 class="text-3xl font-bold mb-4">¡Cuestionario Finalizado!</h2>
      <p class="text-xl mb-6">Tu puntuación final es: <span class="font-bold text-indigo-400">${score} de ${questions.length}</span></p>
      <button id="restart-btn" class="w-full bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-3 px-4 rounded-lg text-lg transition-colors">
        Volver a Intentar
      </button>
    `;
    document.querySelector('#restart-btn').addEventListener('click', startGame);
  };
    startBtn.addEventListener('click', startGame);



</script>